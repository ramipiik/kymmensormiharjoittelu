<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport", charset="utf-8" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
    <title>10-sormijärjestelmä</title>
    <link rel="stylesheet" href= "{{ url_for('static',filename='styles/style.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        {% if not session.user_id %}
            <a href="/login">Kirjaudu sisään:</a>
        {% else %}
            <span id="total_tried_helper" style="display: none;">{{total_tried}}</span>
            <span id="total_passed_helper" style="display: none;">{{total_passed}}</span>
            <p>Olet kirjautunut sisään tunnuksella: {{ session.username }}. <a href="/logout">Kirjaudu ulos</a> </p>
            
            {% if session.admin %}
                <p><a href="/admin">Admin panel</a></p>
            {% endif %}
            <p>Filter exercises by level:</p>
            {% for level in levels %}
                <input type="radio" name="chosen_level" value={{level}} onclick="filter({{level}}, {{tried}}, {{passed_by_level}})"> {{level}}
            {% endfor %}
            <input type="radio" name="chosen_level" value="All" onclick="filter('all')"> All<br><br>
            Number of exercises: <span id="totalExercises">{{total}}</span><br>
            Exercises tried: <span id="tried">{{total_tried}}</span><br>
            Exercises passed: <span id="passed">{{total_passed}}</span><br>
            <h2>Harjoitukset:</h2>
            <hr>
                {% for exercise in exercises %}
                    <!-- <div class="row" >           -->
                        <div name="item" >
                            <!-- <div class="col-4">   -->
                                {% if exercise[4] %}
                                    <div style="position:relative; left: 90px">
                                {% else%}
                                    <div style="position:relative; left: 90px">
                                {% endif %}
                                        <div>Nimi: <a href="/exercises/{{ exercise[0] }}">{{ exercise[1] }}</a></div>
                                        <div>Taso: <span id="level">{{ exercise[3] }}</span></div>
                                        <div>Kuvaus: {{ exercise[2] }}</div>
                                    </div>
                            <!-- </div> -->
                            <!-- <div class="col-4"> -->
                                {% if exercise[4] %}
                                    <div style="margin-bottom: -50px">
                                        <img src= "{{ url_for('static',filename='images/trophy1.jpeg') }}" style="width: 50px; position:relative; bottom: 65px">
                                    </div>
                                {% endif %}
                            <!-- </div> -->
                            <hr>
                        </div>
                    <!-- </div> -->
                    
                {% endfor %}
        {% endif %}
    </div>
</body>
<script>
    function filter(level, tried, passed) {
        elements = document.getElementsByName('item');
        // Loop through all list items, and hide those who don't match the search query
        count=0
        
        for (i = 0; i < elements.length; i++) {
            a = elements[i].getElementsByTagName("span")[0];
            txtValue = a.textContent || a.innerText;
            if (txtValue == level.toString() || level=="all") {
                elements[i].style.display = "";
                count++;
            }
            else {
                elements[i].style.display = "none";
            } 
        }
        document.getElementById("totalExercises").innerHTML=count

        tried_on_this_level=document.getElementById("total_tried_helper").innerHTML
        passed_on_this_level=document.getElementById("total_passed_helper").innerHTML
        // console.log("tried_on_this_level", tried_on_this_level)

        if (level != 'all'){
            if (tried[level]) {
                tried_on_this_level=tried[level]
            } else {
                tried_on_this_level=0
            }
            if (passed[level]) {
                passed_on_this_level=passed[level]
            } else {
                passed_on_this_level=0
            }
            // passed_on_this_level=passed[level]
        }
        document.getElementById("tried").innerHTML=tried_on_this_level
        document.getElementById("passed").innerHTML=passed_on_this_level

    }
</script>